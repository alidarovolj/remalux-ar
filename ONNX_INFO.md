# Информация об ONNX моделях в проекте

## Модель `model.onnx`

**Расположение:** `Assets/Models/model.onnx`

**Размер:** 14 МБ

**Входные данные:**
- `pixel_values`: tensor(float), форма: ['batch_size', 'num_channels', 'height', 'width']
  - batch_size: по умолчанию 1
  - num_channels: 3 (RGB) - **несоответствие с WallSegmentation.cs, где указано 32 канала**
  - height: динамическая (32 в WallSegmentation.cs)
  - width: динамическая (32 в WallSegmentation.cs)

**Выходные данные:**
- `logits`: tensor(float), форма: ['batch_size', 'num_labels', 'height', 'width']
  - batch_size: 1
  - num_labels: 150 (количество классов) - **несоответствие с WallSegmentation.cs, класс стены с индексом 9 занимает 67-е место по активации**
  - height: 8 (downsample от входных данных в 4 раза)
  - width: 8 (downsample от входных данных в 4 раза)

**Анализ классов:**
- **Топ-5 наиболее активных классов:**
  1. Класс 0: -1.787982
  2. Класс 3: -3.830821
  3. Класс 76: -4.894038
  4. Класс 22: -4.949096
  5. Класс 14: -4.997285
- **Предполагаемый класс стены (9):** -7.863040 (67-е место из 150)

**Производитель:** pytorch

**Наименование графа:** torch_jit

## Выявленные несоответствия

В реализации указаны следующие параметры:
- Имя входного тензора: `pixel_values` - корректно для модели model.onnx
- Имя выходного тензора: `logits` - корректно для модели model.onnx
- Размер входной модели: 32x32 пикселя - соответствует документации
- Количество входных каналов: 32 - **не соответствует 3 каналам RGB в модели**
- Индекс класса "стена": 9 - **неоптимально, этот класс занимает только 67-е место по активации**

## Рекомендации по исправлению

1. Привести в соответствие количество каналов (изменить с 32 на 3)
2. Рассмотреть возможность использования другого индекса класса для стен (возможно, 0 или 3 из топ активных)
3. Проверить соответствие предобработки входного изображения с требованиями модели
4. Добавить механизм нормализации выходных данных для улучшения контрастности масок сегментации

## Результаты тестового запуска

### Модель `model.onnx`:
- Статистика выхода:
  - Минимум: -14.07
  - Максимум: -1.57
  - Среднее: -8.14
  - Стандартное отклонение: 1.84

## Примечания по интеграции в Flutter

1. Для запуска ONNX моделей в Flutter рекомендуется использовать пакет `tflite_flutter` с TFLite моделью, конвертированной из ONNX
2. Входной тензор должен иметь формат [batch_size, height, width, channels] (NHWC)
3. Необходима предобработка входного изображения: масштабирование до 32x32, нормализация значений
4. При интерпретации выходных данных следует выбирать класс с наивысшей активацией 

## Рекомендации

1. Оптимизировать модель для мобильных устройств (квантизация, оптимизация размера)
2. Улучшить обработку ошибок при несоответствии форм тензоров
3. Добавить проверку диапазона индексов при доступе к массиву данных тензора
4. Оптимизировать предобработку изображений для повышения скорости работы модели
5. Реализовать буферизацию результатов для снижения нагрузки при обработке потока с камеры 