# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã "UI actions are only available on root isolate"

## üêõ –ü—Ä–æ–±–ª–µ–º–∞
–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤—ã–¥–∞–≤–∞–ª–æ –º–∞—Å—Å–æ–≤—ã–µ –æ—à–∏–±–∫–∏:
```
‚ùå –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ SegFormer –≤ –∏–∑–æ–ª—è—Ç–µ: UI actions are only available on root isolate.
‚ùå –û—à–∏–±–∫–∞ –≤ –∏–∑–æ–ª—è—Ç–µ —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏: UI actions are only available on root isolate.
```

## üîç –ü—Ä–∏—á–∏–Ω–∞
–í `SegmentationService` –≤–Ω—É—Ç—Ä–∏ —Ñ–æ–Ω–æ–≤–æ–≥–æ –∏–∑–æ–ª—è—Ç–∞ –ø—ã—Ç–∞–ª–∏—Å—å —Å–æ–∑–¥–∞—Ç—å UI –æ–±—ä–µ–∫—Ç—ã:
- `ui.Path()` - UI –æ–±—ä–µ–∫—Ç –¥–ª—è –º–∞—Å–∫–∏ —Å—Ç–µ–Ω—ã
- `ui.Rect.fromLTWH()` - UI –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∏

–í–æ Flutter UI –æ–ø–µ—Ä–∞—Ü–∏–∏ –º–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω—è—Ç—å —Ç–æ–ª—å–∫–æ –≤ –≥–ª–∞–≤–Ω–æ–º (root) –∏–∑–æ–ª—è—Ç–µ. –ü–æ–ø—ã—Ç–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è UI –æ–±—ä–µ–∫—Ç–æ–≤ –≤ —Ñ–æ–Ω–æ–≤–æ–º –∏–∑–æ–ª—è—Ç–µ –≤—ã–∑—ã–≤–∞–µ—Ç —Ñ–∞—Ç–∞–ª—å–Ω—É—é –æ—à–∏–±–∫—É.

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### 1. –ò–∑–º–µ–Ω–∏–ª–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö
**–ë—ã–ª–æ:**
```dart
class SegmentationResult {
  final ui.Path wallMask; // ‚ùå UI –æ–±—ä–µ–∫—Ç
}
```

**–°—Ç–∞–ª–æ:**
```dart
class SegmentationResult {
  final List<WallRect> wallRects; // ‚úÖ –ß–∏—Å—Ç—ã–µ –¥–∞–Ω–Ω—ã–µ
}

class WallRect {
  final double x, y, width, height; // ‚úÖ –ü—Ä–æ—Å—Ç—ã–µ —á–∏—Å–ª–∞
}
```

### 2. –†–∞–∑–¥–µ–ª–∏–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∫—É
**–í –∏–∑–æ–ª—è—Ç–µ (—Ñ–æ–Ω–æ–≤—ã–π –ø–æ—Ç–æ–∫):**
- –û–±—Ä–∞–±–æ—Ç–∫–∞ AI –º–æ–¥–µ–ª–∏ SegFormer
- –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç —Å—Ç–µ–Ω –∫–∞–∫ –ø—Ä–æ—Å—Ç—ã–µ —á–∏—Å–ª–∞
- –í–æ–∑–≤—Ä–∞—Ç —Å–ø–∏—Å–∫–∞ `WallRect` (–±–µ–∑ UI –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π)

**–í –≥–ª–∞–≤–Ω–æ–º –ø–æ—Ç–æ–∫–µ:**
- –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ—Ç –∏–∑–æ–ª—è—Ç–∞ 
- –°–æ–∑–¥–∞–Ω–∏–µ `ui.Path` –∏–∑ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
- –ü–µ—Ä–µ–¥–∞—á–∞ –≥–æ—Ç–æ–≤–æ–≥–æ UI –æ–±—ä–µ–∫—Ç–∞ –≤ –æ—Ç—Ä–∏—Å–æ–≤–∫—É

### 3. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –∫–æ–¥

```dart
// –í –∏–∑–æ–ª—è—Ç–µ - —Ç–æ–ª—å–∫–æ –¥–∞–Ω–Ω—ã–µ
static List<WallRect> _extractWallRectsFromSegmentation(...) {
  final wallRects = <WallRect>[];
  // ... –æ–±—Ä–∞–±–æ—Ç–∫–∞ ...
  wallRects.add(WallRect(x: screenX, y: screenY, width: scaleX, height: scaleY));
  return wallRects; // ‚úÖ –ü—Ä–æ—Å—Ç—ã–µ –¥–∞–Ω–Ω—ã–µ
}

// –í –≥–ª–∞–≤–Ω–æ–º –ø–æ—Ç–æ–∫–µ - —Å–æ–∑–¥–∞–Ω–∏–µ UI
ui.Path _createWallPathFromRects(List<WallRect> wallRects) {
  final wallMask = ui.Path(); // ‚úÖ UI –æ–ø–µ—Ä–∞—Ü–∏—è –≤ –≥–ª–∞–≤–Ω–æ–º –ø–æ—Ç–æ–∫–µ
  for (final rect in wallRects) {
    wallMask.addRect(ui.Rect.fromLTWH(rect.x, rect.y, rect.width, rect.height));
  }
  return wallMask;
}
```

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç
- ‚ùå –£—Å—Ç—Ä–∞–Ω–µ–Ω—ã –æ—à–∏–±–∫–∏ "UI actions are only available on root isolate"
- ‚úÖ SegFormer –º–æ–¥–µ–ª—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –≤ —Ñ–æ–Ω–æ–≤–æ–º –∏–∑–æ–ª—è—Ç–µ
- ‚úÖ UI –æ—Å—Ç–∞–µ—Ç—Å—è –æ—Ç–∑—ã–≤—á–∏–≤—ã–º –≤–æ –≤—Ä–µ–º—è AI –æ–±—Ä–∞–±–æ—Ç–∫–∏
- ‚úÖ –°–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è —Å—Ç–µ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ

## üìö –£—Ä–æ–∫
**–ü—Ä–∞–≤–∏–ª–æ –∏–∑–æ–ª—è—Ç–æ–≤ –≤–æ Flutter:**
- –ò–∑–æ–ª—è—Ç—ã –º–æ–≥—É—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —á–∏—Å—Ç—ã–µ –¥–∞–Ω–Ω—ã–µ (—á–∏—Å–ª–∞, —Å—Ç—Ä–æ–∫–∏, —Å–ø–∏—Å–∫–∏)
- UI –æ–±—ä–µ–∫—Ç—ã (`Path`, `Rect`, `Color`, etc.) —Å–æ–∑–¥–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ –≥–ª–∞–≤–Ω–æ–º –ø–æ—Ç–æ–∫–µ
- –ü–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ –º–µ–∂–¥—É –∏–∑–æ–ª—è—Ç–∞–º–∏ –ø—Ä–∏–º–∏—Ç–∏–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –∞ UI —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

–≠—Ç–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ Flutter –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è thread-safety UI —Å–∏—Å—Ç–µ–º—ã. 